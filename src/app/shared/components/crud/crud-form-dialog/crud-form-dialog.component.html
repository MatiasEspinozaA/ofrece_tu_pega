<div class="crud-form-dialog">
  <h2 mat-dialog-title>
    <mat-icon>{{ isEditMode() ? 'edit' : 'add_circle' }}</mat-icon>
    {{ config.title }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="form" class="crud-form">
      @for (field of config.fields; track field.key) {
        <div class="form-field">
          @switch (field.type) {
            @case ('textarea') {
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ field.label }}</mat-label>
                <textarea
                  matInput
                  [formControlName]="field.key"
                  [placeholder]="field.placeholder || ''"
                  [rows]="field.rows || 4"
                ></textarea>
                @if (field.hint) {
                  <mat-hint>{{ field.hint }}</mat-hint>
                }
                @if (form.get(field.key)?.hasError('required') && form.get(field.key)?.touched) {
                  <mat-error>Este campo es requerido</mat-error>
                }
              </mat-form-field>
            }
            @case ('select') {
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ field.label }}</mat-label>
                <mat-select [formControlName]="field.key">
                  @for (option of field.options; track option.value) {
                    <mat-option [value]="option.value">
                      {{ option.label }}
                    </mat-option>
                  }
                </mat-select>
                @if (field.hint) {
                  <mat-hint>{{ field.hint }}</mat-hint>
                }
                @if (form.get(field.key)?.hasError('required') && form.get(field.key)?.touched) {
                  <mat-error>Este campo es requerido</mat-error>
                }
              </mat-form-field>
            }
            @case ('checkbox') {
              <mat-checkbox [formControlName]="field.key" class="checkbox-field">
                {{ field.label }}
              </mat-checkbox>
              @if (field.hint) {
                <div class="hint-text">{{ field.hint }}</div>
              }
            }
            @case ('date') {
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ field.label }}</mat-label>
                <input
                  matInput
                  [matDatepicker]="picker"
                  [formControlName]="field.key"
                  [placeholder]="field.placeholder || ''"
                />
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
                @if (field.hint) {
                  <mat-hint>{{ field.hint }}</mat-hint>
                }
                @if (form.get(field.key)?.hasError('required') && form.get(field.key)?.touched) {
                  <mat-error>Este campo es requerido</mat-error>
                }
              </mat-form-field>
            }
            @case ('file') {
              <div class="file-upload-field">
                <mat-label>{{ field.label }}</mat-label>
                <div class="file-input-wrapper">
                  <input
                    type="file"
                    #fileInput
                    (change)="onFileSelected($event, field.key)"
                    accept="image/*"
                    style="display: none"
                  />
                  <button
                    type="button"
                    mat-stroked-button
                    (click)="fileInput.click()"
                  >
                    <mat-icon>upload_file</mat-icon>
                    Seleccionar archivo
                  </button>
                  @if (fileNames[field.key]) {
                    <span class="file-name">{{ fileNames[field.key] }}</span>
                  }
                </div>
                @if (field.hint) {
                  <div class="hint-text">{{ field.hint }}</div>
                }
              </div>
            }
            @default {
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>{{ field.label }}</mat-label>
                <input
                  matInput
                  [type]="field.type"
                  [formControlName]="field.key"
                  [placeholder]="field.placeholder || ''"
                />
                @if (field.hint) {
                  <mat-hint>{{ field.hint }}</mat-hint>
                }
                @if (form.get(field.key)?.hasError('required') && form.get(field.key)?.touched) {
                  <mat-error>Este campo es requerido</mat-error>
                }
                @if (form.get(field.key)?.hasError('email') && form.get(field.key)?.touched) {
                  <mat-error>Email inv√°lido</mat-error>
                }
              </mat-form-field>
            }
          }
        </div>
      }
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">
      {{ config.cancelLabel || 'Cancelar' }}
    </button>
    <button
      mat-raised-button
      color="primary"
      (click)="onSubmit()"
      [disabled]="!form.valid"
    >
      {{ config.submitLabel || (isEditMode() ? 'Guardar cambios' : 'Crear') }}
    </button>
  </mat-dialog-actions>
</div>
